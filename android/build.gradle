import org.jetbrains.kotlin.gradle.tasks.KotlinCompile

buildscript {
    ext.ktlintVersion = '0.48.0'
    ext.kotlinVersion = '2.0.21'
    ext.androidApplicationVersion = '8.13.0'

    ext.navigationVersion = '2.9.1'
    ext.hiltVersion = '2.57.1'
    ext.googleServicesVersion = '4.3.12'

//    repositories {
//        google()
//        mavenCentral()
//    }

    dependencies {
        classpath "com.android.tools.build:gradle:$androidApplicationVersion"
        classpath "com.squareup:javapoet:1.13.0"
        classpath 'com.google.gms:google-services:4.4.3'

        classpath 'com.facebook.react:react-native-gradle-plugin'

        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion"

        classpath "com.google.dagger:hilt-android-gradle-plugin:$hiltVersion"

        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }

}

plugins {
    id 'com.android.application' version "$androidApplicationVersion" apply false
    id 'com.android.library' version "$androidApplicationVersion" apply false
    id 'org.jetbrains.kotlin.android' version "$kotlinVersion" apply false
    id 'org.jetbrains.kotlin.plugin.compose' version "$kotlinVersion" apply false
    id 'org.jetbrains.kotlin.plugin.serialization' version "$kotlinVersion" apply false
    id "com.diffplug.spotless" version "7.2.1" // apply false
    id 'com.autonomousapps.dependency-analysis' version "2.19.0"  apply false
    id "com.dorongold.task-tree" version "4.0.1"
    id 'com.google.firebase.crashlytics' version '3.0.5' apply false
}

subprojects {
    apply plugin: 'com.autonomousapps.dependency-analysis'
    dependencyAnalysis {
        issues {
            onUnusedDependencies {
                severity('fail')
                exclude(
                        ':v4:integration:cosmos',
                        'androidx.annotation:annotation',
                        'androidx.compose.ui:ui-tooling',
                        'androidx.customview:customview',
                        'androidx.customview:customview-poolingcontainer',
                        'androidx.compose.ui:ui-tooling-preview',
                        'androidx.navigation:navigation-compose',
                        'androidx.test:core',
                        'androidx.tracing:tracing',
                        'com.google.dagger:dagger-compiler',
                        'com.google.dagger:hilt-android',
                        'com.google.dagger:hilt-compiler',
                        'com.google.firebase:firebase-bom',
                        'com.jakewharton.timber:timber',
                        'org.slf4j:slf4j-android',
                )
            }
            onUnusedAnnotationProcessors {
                exclude(
                        'com.google.dagger:hilt-compiler',
                )
            }
            onUsedTransitiveDependencies {
                severity('warn')
                exclude(
                        'androidx.annotation:annotation',
                        'javax.inject:javax.inject',
                        'com.google.guava:listenablefuture',
                )
            }
        }
    }

    tasks.withType(KotlinCompile).configureEach {
        kotlinOptions {
            freeCompilerArgs += '-opt-in=kotlin.RequiresOptIn'
            freeCompilerArgs += '-opt-in=kotlin.Experimental'
        }
    }

//    gradle.taskGraph.whenReady {
//        connectedDebugAndroidTest {
//            ignoreFailures = true
//        }
//    }
}

allprojects {
    apply plugin: 'com.diffplug.spotless'
    spotless {
        kotlin {
            target "v4/**/*.kt"
            targetExclude ".idea/"
            //editorConfigOverride(mapOf("android" to "true"))

            ktlint(ktlintVersion)
                   // .userData(["android" : "true"])
                    .editorConfigOverride([
                            "ktlint_standard_enum-entry-name-case" : "disabled",
                            "ktlint_standard_trailing-comma-on-declaration-site": "disabled",
                            "ktlint_standard_no-semi": "disabled",
                    ])
        }
    }
    ext {
        //dependencies shared between both v3 and v4
    }
}


tasks.named('check') {
//    dependsOn buildHealth
    dependsOn spotlessApply
}

configurations.all {
    resolutionStrategy {
        force 'com.google.guava:guava:33.1.0-jre'
    }
}

ext {
    // Sdk and tools
    minSdkVersion = 28 // https://apilevels.com/
    targetSdkVersion = 35
    compileSdkVersion = 35

    // App dependencies
    abacusVersion = '1.14.12'
    kollectionsVersion = '2.0.16'

    accompanistVersion = '0.23.1'
    accompanistPermissionsVersion = '0.34.0'
    activityComposeVersion = '1.10.1'
    androidXVersion = '1.0.0'
    androidXTracingVersion = '1.2.0'
    androidXAnnotations = '1.4.0'
    appcompatVersion = '1.7.1'
    archLifecycleVersion = '2.9.2'
    archTestingVersion = '2.2.0'
    biometricVersion = '1.2.0-alpha05'
    camerax_version = '1.4.0'
    coilVersion = '2.6.0'
    composeCompilerVersion = '1.5.14'
    composeVersion = '1.6.0'
    coroutinesVersion = '1.6.1'
    customviewVersion = '1.2.0-alpha02'
    customviewPoolingVersion = '1.0.0'
    datastoreVersion='1.0.0'
    dexMakerVersion = '2.12.1'
    espressoVersion = '3.5.0'
    firebaseBomVersion = '33.0.0'
    hamcrestVersion = '1.3'
    hiltAndroidXVersion = '1.2.0'
    junitVersion = '4.13.2'
    junitExtVersion = '1.1.3'
    kaspressoVersion = '1.5.2'
    kotlinxSerializationVersion='1.5.0'
    kotlinxDatetimeVersion='0.4.0'
    ktorVersion = '2.0.3'
    mpAndroidChartVersion ='v3.1.0'
    okhttpVersion = '4.11.0'
    rulesVersion = '1.0.1'
    stethoVersion='1.6.0'
    timberVersion = '5.0.1'
    truthVersion = '1.1.3'
    woodVersion = '0.9.9.1'
    gsonVersion = '2.13.1'
    flowExtVersion = '0.7.1'
    material3Version = '1.2.0-rc01'
    web3jVersion = '4.8.8-android'
    walletConnectVersion = '1.35.2'
    amplitudeVersion = '1.21.4'
}



